<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Profile</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 700px;
            margin: auto;
            padding: 20px;
        }

        .profile-card {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 10px;
        }

        .counts {
            margin: 15px 0;
            font-weight: bold;
        }

        .btn {
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            margin-right: 10px;
            display: inline-block;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
    </style>
</head>
<body>

<div class="profile-card">

    <h2 th:text="${profile.fullName} ?: ${profile.username}"></h2>

    <p><strong>@</strong><span th:text="${profile.username}"></span></p>
    <p><strong>Email:</strong> <span th:text="${profile.email}"></span></p>
    <p><strong>Role:</strong> <span th:text="${profile.role}"></span></p>
    <p><strong>Bio:</strong> <span th:text="${profile.bio}"></span></p>

    <div class="counts">
        Followers: <span th:text="${profile.followerCount}"></span> |
        Following: <span th:text="${profile.followingCount}"></span> |
        Connections: <span th:text="${connectionCount}"></span>
    </div>

    <!-- Show Edit Button only if own profile -->
    <div th:if="${profile.isOwnProfile}">
        <a th:href="@{/profile/edit}" class="btn btn-secondary">Edit Profile</a>
    </div>

    <!-- Show Follow / Unfollow + Connection only if NOT own profile -->
    <div th:if="${!profile.isOwnProfile}">

        <!-- Follow Section (UNCHANGED) -->
        <form th:if="${!profile.isFollowing}"
              th:action="@{/follow/{username}(username=${profile.username})}"
              method="post">
            <button type="submit" class="btn btn-primary">Follow</button>
        </form>

        <form th:if="${profile.isFollowing}"
              th:action="@{/follow/unfollow/{username}(username=${profile.username})}"
              method="post">
            <button type="submit" class="btn btn-danger">Unfollow</button>
        </form>

		<!-- ================= CONNECTION SECTION ================= -->

		<!-- Not Connected -->
		<form th:if="${connectionStatus == 'NONE'}"
		      th:action="@{/connection/send/{username}(username=${profile.username})}"
		      method="post">
		    <button type="submit" class="btn btn-primary">Connect</button>
		</form>

		<!-- Request Sent -->
		<button th:if="${connectionStatus == 'PENDING' and pendingRequestId == null}"
		        class="btn btn-secondary"
		        disabled>
		    Pending
		</button>

		<!-- Request Received -->
		<div th:if="${connectionStatus == 'PENDING' and pendingRequestId != null}">
		    <form th:action="@{/connection/accept/{id}(id=${pendingRequestId})}"
		          method="post" style="display:inline;">
		        <button type="submit" class="btn btn-primary">Accept</button>
		    </form>

		    <form th:action="@{/connection/reject/{id}(id=${pendingRequestId})}"
		          method="post" style="display:inline;">
		        <button type="submit" class="btn btn-danger">Reject</button>
		    </form>
		</div>

		<!-- Connected -->
		<button th:if="${connectionStatus == 'ACCEPTED'}"
		        class="btn btn-secondary"
		        disabled>
		    Connected
		</button>

    </div>

    <br>
    <a th:href="@{/feed}" class="btn btn-secondary">Back to Feed</a>
    <a th:href="@{/logout}" class="btn btn-secondary">Logout</a>

</div>

</body>
</html>